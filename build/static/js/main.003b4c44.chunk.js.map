{"version":3,"sources":["components/InputForm/InputForm.module.css","components/Softkeys/Softkeys.module.css","components/Info/Info.module.css","components/Header/Header.module.css","../node_modules/peerjs/dist sync","components/Header/Header.js","config.js","components/InputForm/InputForm.js","components/Info/Info.js","components/EmptyForm/EmptyForm.js","components/Softkeys/Softkeys.js","peer-service.js","utils.js","App.js","index.js"],"names":["module","exports","webpackEmptyContext","req","e","Error","code","keys","resolve","id","Header","title","className","css","header","peerConfig","InputForm","React","forwardRef","props","ref","label","onSubmit","onSoftLeft","isActive","useState","value","setValue","input","type","onChange","event","target","onKeyDown","key","inputForm","trimmedValue","trim","preventDefault","Info","text","style","isMessage","message","prompt","info","EmptyForm","width","height","opacity","Softkeys","left","center","right","softKeys","peer","localStream","callAnswered","reducer","state","action","me","data","status","contact","refs","Registration","createRef","Listening","Conversation","getSoftKeyProps","App","audio","Audio","autoplay","u","useReducer","dispatch","useEffect","current","focus","handleLeave","destroy","cb","open","close","srcObject","error","err","stream","remoteStream","rmCode","Peer","on","navigator","mediaDevices","getUserMedia","video","then","catch","getTracks","forEach","t","stop","mediaConnection","answer","call","timeout","setTimeout","clearTimeout","callPear","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.003b4c44.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"inputForm\":\"InputForm_inputForm__10-Mc\",\"label\":\"InputForm_label__ffqu2\",\"input\":\"InputForm_input__18_QU\",\"code\":\"InputForm_code__2b8Cr\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"softKeys\":\"Softkeys_softKeys__33jJi\",\"left\":\"Softkeys_left__3jywJ\",\"right\":\"Softkeys_right__2gKj5\",\"center\":\"Softkeys_center__2rLlj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"info\":\"Info_info__2d-ke\",\"prompt\":\"Info_prompt__1PADz\",\"message\":\"Info_message__2Mj9L\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__1VCKf\",\"title\":\"Header_title__3SH2Q\"};","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 17;","import css from \"./Header.module.css\";\n\nconst Header = ({ title }) => {\n  return (\n    <header className={css.header}>\n      <span className={css.title}>{title}</span>\n    </header>\n  );\n};\n\nexport { Header };\n","// export const peerConfig = {\n//   host: window.location.hostname,\n//   port: 9000,\n//   path: '/web-phone',\n//   debug: 2\n// };\n\nexport const peerConfig = {};\n\n// export const keys = {\n//   left: \"ArrowLeft\",\n//   right: \"ArrowRight\"\n// };\n\nexport const keys = {\n  left: \"SoftLeft\",\n  right: \"SoftRight\"\n};\n","import React, { useState } from \"react\";\nimport { keys } from \"../../config\";\nimport css from \"./InputForm.module.css\";\n\nconst InputForm = React.forwardRef((props, ref) => {\n  const { label, onSubmit, onSoftLeft, isActive, code } = props;\n\n  const [value, setValue] = useState(\"\");\n\n  const handleChange = event => {\n    setValue(event.target.value);\n  };\n\n  const handleKey = event => {\n    switch (event.key) {\n      case keys.right:\n        setValue(\"\");\n        return;\n      case keys.left:\n        onSoftLeft && onSoftLeft();\n        return;\n      default:\n        return;\n    }\n  }\n\n  const handleSubmit = event => {\n    const trimmedValue = value.trim();\n    if (trimmedValue) {\n      onSubmit(trimmedValue);\n    }\n    event.preventDefault();\n  };\n\n  const input = (\n    <input\n      className={css.input}\n      ref={ref}\n      type=\"text\"\n      value={value}\n      onChange={handleChange}\n      onKeyDown={handleKey}\n    />\n  );\n\n  const id = (<span className={css.code}>{code}</span>);\n\n  return (\n    <form className={css.inputForm} onSubmit={handleSubmit}>\n      <label>\n        <span className={css.label}>{label}{\":\"}</span>\n        {isActive ? input : id}\n      </label>\n    </form>\n  );\n});\n\nexport { InputForm };\n","import css from \"./Info.module.css\";\n\nconst Info = ({ text, isMessage }) => {\n  const style = isMessage ? css.message : css.prompt;\n\n  return (\n    <div className={css.info}>\n      <span className={style}>{text}</span>\n    </div>\n  );\n};\n\nexport { Info };\n","import React from \"react\";\n\nconst EmptyForm = React.forwardRef(({ onSubmit }, ref) => {\n  const handleSubmit = event => {\n    onSubmit();\n    event.preventDefault();\n  };\n\n  return (\n    <form onSubmit={handleSubmit} style={{ width: 0, height: 0 }}>\n      <input ref={ref} type=\"text\" style={{ opacity: 0 }}/>\n    </form>\n  );\n});\n\nexport { EmptyForm };\n","import css from \"./Softkeys.module.css\";\n\nconst Softkeys = ({ left, center, right }) => {\n  return (\n    <div className={css.softKeys}>\n      <label className={css.left}>{left}</label>\n      <label className={css.center}>{center}</label>\n      <label className={css.right}>{right}</label>\n    </div>\n  );\n};\n\nexport { Softkeys };\n","import Peer from \"peerjs\";\nimport { peerConfig } from \"./config\";\n\nconst WAIT_FOR_ANSWER_MS = 5000;\n\nlet peer = null;\nlet localStream = null;\nlet callAnswered = false;\n\nexport function createPeer(code, cb) {\n  peer = new Peer(code, peerConfig);\n\n  peer.on(\"open\", id => {\n    navigator.mediaDevices.getUserMedia({ video: false, audio: true })\n      .then(stream => localStream = stream)\n      .then(() => callAnswered = false)\n      .then(() => cb.open(id))\n      .catch(err => cb(err));\n  });\n\n  peer.on(\"close\", () => {\n    localStream && localStream.getTracks().forEach(t => t.stop());\n    cb.close();\n  });\n\n  peer.on(\"error\", err => cb.error(err));\n\n  peer.on(\"call\", mediaConnection => {\n    // Remote peer answers to only one call\n    if (callAnswered) {\n      return;\n    }\n\n    callAnswered = true;\n\n    mediaConnection.answer(localStream);\n    const rmCode = mediaConnection.peer;\n    mediaConnection.on(\"stream\", stream => cb.stream(stream, rmCode));\n  });\n}\n\nexport function destroyPeer() {\n  peer.destroy();\n}\n\nexport function callPear(rmCode, cb) {\n  const mediaConnection = peer.call(rmCode, localStream);\n\n  // Wait for remote stream\n  const timeout = setTimeout(\n    () => !mediaConnection.open && cb.timeout(),\n    WAIT_FOR_ANSWER_MS\n  );\n\n  mediaConnection.on(\"stream\", stream => {\n    clearTimeout(timeout);\n    cb.stream(stream);\n  });\n}\n","import React from \"react\";\n\nexport const reducer = (state, action) => {\n  switch (action.type) {\n    case \"LISTEN\":\n      return {\n        ...state,\n        me: action.data,\n        status: \"Listening\",\n        message: \"\"\n      };\n    case \"CONNECT\":\n      return {\n        ...state,\n        contact: action.data,\n        status: \"Conversation\",\n        message: \"\"\n      };\n    case \"REGISTER\":\n      return {\n        ...state,\n        me: \"\",\n        contact: \"\",\n        status: \"Registration\"\n      };\n    case \"MESSAGE\":\n      return {\n        ...state,\n        message: action.data\n      }\n    default:\n      return;\n  }\n};\n\nexport const refs = {\n  Registration: React.createRef(),\n  Listening: React.createRef(),\n  Conversation: React.createRef()\n};\n\nexport const getSoftKeyProps = status => {\n  const map = {\n    Registration: { left: null, center: \"JOIN\", right: \"Clear\" },\n    Listening: { left: \"Leave\", center: \"CALL\", right: \"Clear\" },\n    Conversation: { left: null, center: \"LEAVE\", right: null }\n  };\n  return map[status];\n};\n\nexport const getInfo = status => {\n  const map = {\n    Registration: \"Please, input your code.\",\n    Listening: \"Wait for conversation or connect to your contact.\",\n    Conversation: \"Talk with contact.\"\n  };\n  return map[status];\n};\n\nexport const getAudio = () => {\n  const audio = new Audio();\n  audio.autoplay = true;\n  return audio;\n}\n","import { useState, useReducer, useEffect } from \"react\";\nimport { Header, InputForm, EmptyForm, Info, Softkeys } from \"./components\";\nimport { createPeer, destroyPeer, callPear } from \"./peer-service\";\nimport * as u from \"./utils\";\n\nconst App = () => {\n  const [audio] = useState(u.getAudio());\n\n  const[state, dispatch] = useReducer(u.reducer, {\n    status: \"Registration\", \n    me: \"\",\n    contact: \"\",\n    message: \"\"\n  });\n\n  useEffect(() =>\n    u.refs[state.status].current.focus()\n  );\n\n  const handleJoin = id => {\n    dispatch({ type: \"MESSAGE\", data: \"Wait, please!\" });\n\n    createPeer(id, {\n      open(id) {\n        dispatch({ type: \"LISTEN\", data: id });\n      },\n      close() {\n        audio.srcObject = null;\n        dispatch({ type: \"REGISTER\" });\n      },\n      error(err) {\n        dispatch({ type: \"MESSAGE\", data: err.message });\n      },\n      stream(remoteStream, rmCode) {\n        audio.srcObject = remoteStream;\n        dispatch({ type: \"CONNECT\", data: rmCode });\n      }\n    })\n  };\n\n  const handleConnect = id => {\n    if (id === state.me) {\n      dispatch({ type: \"MESSAGE\", data: \"Cannot connect to myself\" });\n      return;\n    }\n\n    dispatch({ type: \"MESSAGE\", data: \"Wait, please!\" });\n\n    callPear(id, {\n      stream(remoteStream) {\n        audio.srcObject = remoteStream;\n        dispatch({ type: \"CONNECT\", data: id });\n      },\n      timeout() {\n        dispatch({ type: \"MESSAGE\", data: `Could not connect to peer ${id}` });\n      }\n    });\n  };\n\n  const handleLeave = () =>  {\n    dispatch({ type: \"MESSAGE\", data:  \"\" });\n    destroyPeer();\n  }\n\n  return (\n    <>\n      <Header title={state.status} />\n      <InputForm\n        ref={u.refs.Registration}\n        label=\"Me\"\n        onSubmit={handleJoin}\n        isActive={state.status === \"Registration\"}\n        code={state.me}\n      />\n      <InputForm\n        ref={u.refs.Listening}\n        label=\"Contact\"\n        onSubmit={handleConnect}\n        onSoftLeft={handleLeave}\n        isActive={state.status === \"Listening\"}\n        code={state.contact}\n      />\n      <EmptyForm\n        ref={u.refs.Conversation}\n        onSubmit={handleLeave}\n      />\n      <Info text={u.getInfo(state.status)} />\n      <Info text={state.message} isMessage={true} />\n      <Softkeys {...u.getSoftKeyProps(state.status)} />\n    </>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n    <App />,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}