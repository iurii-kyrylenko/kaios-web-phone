(this["webpackJsonpkaios-web-phone"]=this["webpackJsonpkaios-web-phone"]||[]).push([[0],[,,,,function(e,t,n){e.exports={inputForm:"InputForm_inputForm__10-Mc",label:"InputForm_label__ffqu2",input:"InputForm_input__18_QU",code:"InputForm_code__2b8Cr"}},function(e,t,n){e.exports={softKeys:"Softkeys_softKeys__33jJi",left:"Softkeys_left__3jywJ",right:"Softkeys_right__2gKj5",center:"Softkeys_center__2rLlj"}},function(e,t,n){e.exports={info:"Info_info__2d-ke",prompt:"Info_prompt__1PADz",message:"Info_message__2Mj9L"}},,function(e,t,n){e.exports={header:"Header_header__1VCKf",title:"Header_title__3SH2Q"}},,,,,,,function(e,t,n){},,function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=17},function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(9),s=n.n(c),o=(n(15),n(2)),i=n(3),u=n(8),l=n.n(u),f=n(0),j=function(e){var t=e.title;return Object(f.jsx)("header",{className:l.a.header,children:Object(f.jsx)("span",{className:l.a.title,children:t})})},b={},d="SoftLeft",m="SoftRight",p=n(4),O=n.n(p),h=r.a.forwardRef((function(e,t){var n=e.label,r=e.onSubmit,c=e.onSoftLeft,s=e.isActive,o=e.code,u=Object(a.useState)(""),l=Object(i.a)(u,2),j=l[0],b=l[1],p=Object(f.jsx)("input",{className:O.a.input,ref:t,type:"text",value:j,onChange:function(e){b(e.target.value)},onKeyDown:function(e){switch(e.key){case m:return void b("");case d:return void(c&&c());default:return}}}),h=Object(f.jsx)("span",{className:O.a.code,children:o});return Object(f.jsx)("form",{className:O.a.inputForm,onSubmit:function(e){var t=j.trim();t&&r(t),e.preventDefault()},children:Object(f.jsxs)("label",{children:[Object(f.jsxs)("span",{className:O.a.label,children:[n,":"]}),s?p:h]})})})),_=n(6),g=n.n(_),v=function(e){var t=e.text,n=e.isMessage?g.a.message:g.a.prompt;return Object(f.jsx)("div",{className:g.a.info,children:Object(f.jsx)("span",{className:n,children:t})})},S=r.a.forwardRef((function(e,t){var n=e.onSubmit;return Object(f.jsx)("form",{onSubmit:function(e){n(),e.preventDefault()},style:{width:0,height:0},children:Object(f.jsx)("input",{ref:t,type:"text",style:{opacity:0}})})})),y=n(5),x=n.n(y),E=function(e){var t=e.left,n=e.center,a=e.right;return Object(f.jsxs)("div",{className:x.a.softKeys,children:[Object(f.jsx)("label",{className:x.a.left,children:t}),Object(f.jsx)("label",{className:x.a.center,children:n}),Object(f.jsx)("label",{className:x.a.right,children:a})]})},N=n(10),C=n.n(N),L=null,R=null,w=null,A=!1;var M=function(e,t){switch(t.type){case"LISTEN":return Object(o.a)(Object(o.a)({},e),{},{me:t.data,status:"Listening",message:""});case"CONNECT":return Object(o.a)(Object(o.a)({},e),{},{contact:t.data,status:"Conversation",message:""});case"REGISTER":return Object(o.a)(Object(o.a)({},e),{},{me:"",contact:"",status:"Registration"});case"MESSAGE":return Object(o.a)(Object(o.a)({},e),{},{message:t.data});default:return}},k={Registration:r.a.createRef(),Listening:r.a.createRef(),Conversation:r.a.createRef()},I=function(e){return{Registration:{left:null,center:"JOIN",right:"Clear"},Listening:{left:"Leave",center:"CALL",right:"Clear"},Conversation:{left:null,center:"LEAVE",right:null}}[e]},T=function(){var e=Object(a.useState)(function(){var e=new Audio;return e.autoplay=!0,e}()),t=Object(i.a)(e,1)[0],n=Object(a.useReducer)(M,{status:"Registration",me:"",contact:"",message:""}),r=Object(i.a)(n,2),c=r[0],s=r[1];Object(a.useEffect)((function(){return k[c.status].current.focus()}));var u,l=function(){s({type:"MESSAGE",data:""}),R.destroy()};return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(j,{title:c.status}),Object(f.jsx)(h,{ref:k.Registration,label:"Me",onSubmit:function(e){var n,a;s({type:"MESSAGE",data:"Wait, please!"}),n=e,a={open:function(e){s({type:"LISTEN",data:e})},close:function(){t.srcObject=null,s({type:"REGISTER"})},error:function(e){s({type:"MESSAGE",data:e.message})},stream:function(e,n){t.srcObject=e,s({type:"CONNECT",data:n})}},(R=new C.a(n,b)).on("open",(function(e){navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(e){return w=e})).then((function(){return A=!1})).then((function(){return a.open(e)})).catch((function(e){return a(e)}))})),R.on("close",(function(){w&&w.getTracks().forEach((function(e){return e.stop()})),a.close()})),R.on("error",(function(e){clearTimeout(L),a.error(e)})),R.on("call",(function(e){A||(e.answer(w),e.on("stream",(function(t){A=!0;var n=e.peer;a.stream(t,n)})))}))},isActive:"Registration"===c.status,code:c.me}),Object(f.jsx)(h,{ref:k.Listening,label:"Contact",onSubmit:function(e){e!==c.me?(s({type:"MESSAGE",data:"Wait, please!"}),function(e,t){var n=R.call(e,w);L=setTimeout((function(){return!n.open&&t.timeout()}),1e4),n.on("stream",(function(e){clearTimeout(L),A=!0,t.stream(e)}))}(e,{stream:function(n){t.srcObject=n,s({type:"CONNECT",data:e})},timeout:function(){s({type:"MESSAGE",data:'Contact "'.concat(e,'" is probably busy')})}})):s({type:"MESSAGE",data:"Cannot connect to myself"})},onSoftLeft:l,isActive:"Listening"===c.status,code:c.contact}),Object(f.jsx)(S,{ref:k.Conversation,onSubmit:l}),Object(f.jsx)(v,{text:(u=c.status,{Registration:"Please, input your code.",Listening:"Wait for conversation or connect to your contact.",Conversation:"Talk with contact."}[u])}),Object(f.jsx)(v,{text:c.message,isMessage:!0}),Object(f.jsx)(E,Object(o.a)({},I(c.status)))]})};s.a.render(Object(f.jsx)(T,{}),document.getElementById("root"))}],[[18,1,2]]]);