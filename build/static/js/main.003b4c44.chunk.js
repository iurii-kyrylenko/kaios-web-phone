(this["webpackJsonpkaios-web-phone"]=this["webpackJsonpkaios-web-phone"]||[]).push([[0],[,,,,function(e,t,n){e.exports={inputForm:"InputForm_inputForm__10-Mc",label:"InputForm_label__ffqu2",input:"InputForm_input__18_QU",code:"InputForm_code__2b8Cr"}},function(e,t,n){e.exports={softKeys:"Softkeys_softKeys__33jJi",left:"Softkeys_left__3jywJ",right:"Softkeys_right__2gKj5",center:"Softkeys_center__2rLlj"}},function(e,t,n){e.exports={info:"Info_info__2d-ke",prompt:"Info_prompt__1PADz",message:"Info_message__2Mj9L"}},,function(e,t,n){e.exports={header:"Header_header__1VCKf",title:"Header_title__3SH2Q"}},,,,,,,function(e,t,n){},,function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=17},function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(9),o=n.n(c),s=(n(15),n(2)),i=n(3),u=n(8),f=n.n(u),l=n(0),j=function(e){var t=e.title;return Object(l.jsx)("header",{className:f.a.header,children:Object(l.jsx)("span",{className:f.a.title,children:t})})},b={},d="SoftLeft",m="SoftRight",p=n(4),O=n.n(p),h=r.a.forwardRef((function(e,t){var n=e.label,r=e.onSubmit,c=e.onSoftLeft,o=e.isActive,s=e.code,u=Object(a.useState)(""),f=Object(i.a)(u,2),j=f[0],b=f[1],p=Object(l.jsx)("input",{className:O.a.input,ref:t,type:"text",value:j,onChange:function(e){b(e.target.value)},onKeyDown:function(e){switch(e.key){case m:return void b("");case d:return void(c&&c());default:return}}}),h=Object(l.jsx)("span",{className:O.a.code,children:s});return Object(l.jsx)("form",{className:O.a.inputForm,onSubmit:function(e){var t=j.trim();t&&r(t),e.preventDefault()},children:Object(l.jsxs)("label",{children:[Object(l.jsxs)("span",{className:O.a.label,children:[n,":"]}),o?p:h]})})})),_=n(6),g=n.n(_),v=function(e){var t=e.text,n=e.isMessage?g.a.message:g.a.prompt;return Object(l.jsx)("div",{className:g.a.info,children:Object(l.jsx)("span",{className:n,children:t})})},S=r.a.forwardRef((function(e,t){var n=e.onSubmit;return Object(l.jsx)("form",{onSubmit:function(e){n(),e.preventDefault()},style:{width:0,height:0},children:Object(l.jsx)("input",{ref:t,type:"text",style:{opacity:0}})})})),x=n(5),y=n.n(x),E=function(e){var t=e.left,n=e.center,a=e.right;return Object(l.jsxs)("div",{className:y.a.softKeys,children:[Object(l.jsx)("label",{className:y.a.left,children:t}),Object(l.jsx)("label",{className:y.a.center,children:n}),Object(l.jsx)("label",{className:y.a.right,children:a})]})},N=n(10),C=n.n(N),L=null,R=null,w=!1;var A=function(e,t){switch(t.type){case"LISTEN":return Object(s.a)(Object(s.a)({},e),{},{me:t.data,status:"Listening",message:""});case"CONNECT":return Object(s.a)(Object(s.a)({},e),{},{contact:t.data,status:"Conversation",message:""});case"REGISTER":return Object(s.a)(Object(s.a)({},e),{},{me:"",contact:"",status:"Registration"});case"MESSAGE":return Object(s.a)(Object(s.a)({},e),{},{message:t.data});default:return}},M={Registration:r.a.createRef(),Listening:r.a.createRef(),Conversation:r.a.createRef()},k=function(e){return{Registration:{left:null,center:"JOIN",right:"Clear"},Listening:{left:"Leave",center:"CALL",right:"Clear"},Conversation:{left:null,center:"LEAVE",right:null}}[e]},I=function(){var e=Object(a.useState)(function(){var e=new Audio;return e.autoplay=!0,e}()),t=Object(i.a)(e,1)[0],n=Object(a.useReducer)(A,{status:"Registration",me:"",contact:"",message:""}),r=Object(i.a)(n,2),c=r[0],o=r[1];Object(a.useEffect)((function(){return M[c.status].current.focus()}));var u,f=function(){o({type:"MESSAGE",data:""}),L.destroy()};return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(j,{title:c.status}),Object(l.jsx)(h,{ref:M.Registration,label:"Me",onSubmit:function(e){var n,a;o({type:"MESSAGE",data:"Wait, please!"}),n=e,a={open:function(e){o({type:"LISTEN",data:e})},close:function(){t.srcObject=null,o({type:"REGISTER"})},error:function(e){o({type:"MESSAGE",data:e.message})},stream:function(e,n){t.srcObject=e,o({type:"CONNECT",data:n})}},(L=new C.a(n,b)).on("open",(function(e){navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(e){return R=e})).then((function(){return w=!1})).then((function(){return a.open(e)})).catch((function(e){return a(e)}))})),L.on("close",(function(){R&&R.getTracks().forEach((function(e){return e.stop()})),a.close()})),L.on("error",(function(e){return a.error(e)})),L.on("call",(function(e){if(!w){w=!0,e.answer(R);var t=e.peer;e.on("stream",(function(e){return a.stream(e,t)}))}}))},isActive:"Registration"===c.status,code:c.me}),Object(l.jsx)(h,{ref:M.Listening,label:"Contact",onSubmit:function(e){e!==c.me?(o({type:"MESSAGE",data:"Wait, please!"}),function(e,t){var n=L.call(e,R),a=setTimeout((function(){return!n.open&&t.timeout()}),5e3);n.on("stream",(function(e){clearTimeout(a),t.stream(e)}))}(e,{stream:function(n){t.srcObject=n,o({type:"CONNECT",data:e})},timeout:function(){o({type:"MESSAGE",data:"Could not connect to peer ".concat(e)})}})):o({type:"MESSAGE",data:"Cannot connect to myself"})},onSoftLeft:f,isActive:"Listening"===c.status,code:c.contact}),Object(l.jsx)(S,{ref:M.Conversation,onSubmit:f}),Object(l.jsx)(v,{text:(u=c.status,{Registration:"Please, input your code.",Listening:"Wait for conversation or connect to your contact.",Conversation:"Talk with contact."}[u])}),Object(l.jsx)(v,{text:c.message,isMessage:!0}),Object(l.jsx)(E,Object(s.a)({},k(c.status)))]})};o.a.render(Object(l.jsx)(I,{}),document.getElementById("root"))}],[[18,1,2]]]);
//# sourceMappingURL=main.003b4c44.chunk.js.map